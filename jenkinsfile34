node {
 def mvnHome = tool 'maven3.9.11'
    def jdkHome = tool 'jdk17'

    // Add to environment
    withEnv(["JAVA_HOME=${jdkHome}", "PATH+JAVA=${jdkHome}/bin", "PATH+MAVEN=${mvnHome}/bin"]){
    stage('1.clonecode'){
        git credentialsId: 'github', url: 'https://github.com/christruly95/maven-web-application/'
        //pretend the above repoURL was private, we would paste that line from the Pipeline Syntax generator link below if your configuring job
        //git "https://github.com/christruly95/maven-web-application"
        //sh "git clone repoURL" and bat "git clone repoURL" will also work on both Linux and Windows system respectively.
    }
    stage('2.mavenbuild'){
        sh "${mvnHome}/bin/mvn package"
    }
    stage('3. codeQualityAnalysis'){
        sh "${mvnHome}/bin/mvn sonar:sonar"
    }
    stage('4.uploadArtifacts'){
        sh "${mvnHome}/bin/mvn deploy"
    }
    stage('5.deploy2UAT'){
        deploy adapters: [tomcat9(alternativeDeploymentContext: '', credentialsId: 'tomcat', path: '', url: 'http://98.93.88.128:8088/')], contextPath: null, war: 'target/*war'
    }
    stage('6.manualApproval'){
        sh "echo 'Please review & approve'"
        timeout(time: 300, unit: 'MINUTES')
        {
            input message:'App ready for deployment, review'
        }
    }
    stage('7.deploy2prod'){
        deploy adapters: [tomcat9(alternativeDeploymentContext: '', credentialsId: 'tomcat', path: '', url: 'http://98.93.88.128:8088/')], contextPath: null, war: 'target/*war'
    }
    stage('8.notification'){
        sh "echo create email notification to resolve any issue that may arise"
        emailext body: '''The build and Deployment status for tesla-webapp.

Regards,
Chris Truly''', recipientProviders: [developers(), upstreamDevelopers()], subject: 'job status', to: 'christruly@gmail.com'
    }
}
}
